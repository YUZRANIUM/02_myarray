# マイ・アレイ ![GitHub release (latest by date including pre-releases)](https://img.shields.io/github/v/release/YUZRANIUM/02_myarray?include_prereleases&style=flat-square)

多次元配列変数をなんやかんやする、なんてことないモジュール

[HSPTV!掲示板]: http://hsp.tv/play/pforum.php

不具合報告や要望等は [HSPTV!掲示板][HSPTV!掲示板] で頂けると幸いです。

## 特徴（Feature）

* 多次元配列変数に格納されている全ての値を複数行文字列として変数に格納.
* 1次元、２次元、3次元、4次元、全ての次元に対応.
* 標準命令のみで動作.
* 変数名、ラベル名の表示.
* 複数行文字列から多次元配列、多次元配列から別の多次元配列へ、次元を超えた変換が可能.
* 配列コピー、文字列型、実数型、整数型の相互変換.
* ラベル型配列変数の生成.

<br>

* 多次元配列変数を複数行文字列にする `priarray` 命令 (由来 : print array)


    | 表示内容 \ 型  | label | str | double | int | struct | COM object |
    |:--------------:|:-----:|:---:|:------:|:---:|:------:|:----------:|
    |     変数名     |   O   |  O  |   O    |  O  |   O    |     O      |
    |       型       |   O   |  O  |   O    |  O  |   O    |     O      |
    |  各次元要素数  |   O   |  O  |   O    |  O  |   O    |     O      |
    |  使用時の行数  |   O   |  O  |   O    |  O  |   O    |     O      |
    |   値の書出し   |   O   |  O  |   O    |  O  |   X    |     X      |
    | 変数の使用状況 |  ---  | --- |  ---   | --- |   O    |     O      |


デバッグウィンドウでも多次元配列変数の中身をテキストに出力できますが、このモジュールで追加される命令を使えばより柔軟なデバッグ作業、確認作業が可能になるはずです.

※あくまでも、デバッグ用、確認用としてお使い下さい.

<br>

* 多次元配列変数に連続代入を行う `setarray` 命令 (由来 : setting array)


    | 動作内容 \ 型 | label | str | double | int | struct | COM object |
    |:-------------:|:-----:|:---:|:------:|:---:|:------:|:----------:|
    |   連続代入    |   -   |  O  |   O    |  O  |   X    |     X      |
    |   増減機能    |   -   |  O  |   O    |  O  |   X    |     X      |

<!--  -->
* 文字列型、実数型、整数型の多次元配列変数への連続代入が可能.
* 実数型、整数型では代入時に増減値を指定することで値を変化させることが可能.
* 文字列型の場合はインデックスの付与として機能します.

ラベル型配列を生成したい場合は`labarray命令`をご使用ください


<br>

## 機能（Function）

<!----------------------------------------------------------------------------->

<details>

<summary>追加される使用可能命令･関数</summary>

~~~ c
// 多次元配列変数の書き出し
//
// p1 : 中身を受け取る文字列型変数
// p2 : 多次元配列変数
// p3 : コメント（省略可）
priarray p1, p2, p3


// 多次元配列変数一括代入
//
// p1 : 代入先の配列変数
// p2 : 代入したい値 (label, str, double, int)
// p3 : indexフラグ(=0)
// p4 : 増減値 (str, double, int)
setarray p1, p2, p3, p4


// 多次元配列変数の値書き出し
//
// p1 : 配列変数の中身を受け取る文字列型変数
// p2 : 配列変数
outarray p1, p2


// 多次元配列に変換する
//
// ary    : 変数名
// in_val : 読み込む複数行文字列若しくは多次元配列変数
// type   : 変換先の型を表す数値  (= 2) (2:文字列型, 3:実数型, 4:整数型)
// d1     : 第1次元要素数 (= 0)
// d2     : 第2次元要素数 (= 0)
// d3     : 第3次元要素数 (= 0)
// d4     : 第4次元要素数 (= 0)
cnvarray ary, in_val, type, d1, d2, d3, d4


// ラベル型配列変数生成
//
// hyouj  : 書き出し先の複数行文字列型変数
// ary    : 書き出す文字列型配列変数
// in_val : 代入値またはそれを格納した変数
// index  : 増減値 (str, double, int)
labarray hyouj, ary, in_val, index
~~~

</details>

<!----------------------------------------------------------------------------->

<details>

<summary>使用方法</summary>

``` c
ldim ary0, 4, 4, 4
sdim ary1, 64, 5, 5, 5, 5
ddim ary2, 10
dim  ary3, 5, 5

// setarray <代入先の配列>, <代入値>, <インデックス使用フラグ(0:off, 1:on)>, <増減値>

setarray ary0, *main            // ラベル型には増減機能は使えません。連続代入のみです
setarray ary1, "ABCDE", 1, 1    // 文字列の場合は、ABCDE, ABCDE1, ABCDE2, ABCDE3, ...
setarray ary2, 0.0, 1, 0.125    // 初期値: 0.0, 増減値: +0.125
setarray ary3, 10, 1, -1        // 初期値: 10, 増減値: -1

// priarray <中身を受け取る文字列型変数>, <多次元配列変数>, <コメント（省略可）>
priarray hyouji, ary1, "文字列にインデックスをつけています"

/***  any processing  ***/

setarray aray1, "け―れー!!", 1, "(｀･ω･´)ゞ"

priarray hyouji, ary1, "増減値に文字列を指定することも可能です"

priarray hyouji, ary3, "10, 9, 8, ... と減少していき、\n0, -1, -2, ...となっていきます"

// スクリプトの途中で内容をテキストファイルとして出力
notesel hyouji
notesave dir_cur + "\\check_array.txt"
```

</details>

<!----------------------------------------------------------------------------->

<details>

<summary>一覧表示のサンプル</summary>

~~~
[ ttsta ] label(10) L=74
(0) = <null label>
(1) = <null label>
(2) = <null label>
(3) = <null label>
(4) = <null label>
(5) = <null label>
(6) = <null label>
(7) = <null label>
(8) = <null label>
(9) = <null label>

[ sub_labl ] label(4) L=97
/*------------------------------
ラベル名表示テスト
------------------------------*/
(0) = *ary_dim
(1) = *fileload
(2) = *type_change
(3) = *loop_ch

[ aa ] str(2) L=98
(0) = ちゃんと変数名も型も行数も表示できますよ
(1) = そう、マクロならね

[ 使い方 ] str(13) L=99
/*------------------------------
コメントの表示形式についてどうでしょうか?
デバッグ用、確認用と謳っているにも関わらず
コメントできないというのはどうなんだろう...
と思いまして。もう少し表示形式を練ってみます
------------------------------*/
(0) = 第一パラメータには文字列型変数を指定して下さい。
(1) = 第二パラメータに中身を見たい多次元配列変数を指定して下さい
(2) = こんなふうに変数名と要素の総数、マクロを呼び出した行数
(3) = そして各配列要素に対応した値が一覧として表示できます
(4) =
(5) = デバッグウィンドウで確認できるって?
(6) = ログ表示をテキストに出力できるって?
(7) = ......
(8) = うっあっあっうわぁぁぁぁぁぁぁぁぁぁぁぁぁぁ
(9) = あっ!!、でっ、でっ、でも明示的にスクリプト内でこういった事が
(10) = できるだけでも存在価値はあるんじゃない?
(11) = ほっ、ほら!
(12) = ログ出力みたいに上書きされずに済むよ(;ﾟ∀ﾟ)=3ﾊｧﾊｧ

[ aray1 ] double(3, 3) L=107
/*------------------------------
処理の前後に挟むと確認ができます
------------------------------*/
(0, 0) = 0.000000
(1, 0) = 0.000000
(2, 0) = 0.000000
(0, 1) = 0.000000
(1, 1) = 0.000000
(2, 1) = 0.000000
(0, 2) = 0.000000
(1, 2) = 0.000000
(2, 2) = 0.000000

[ aray1 ] double(3, 3) L=112
/*------------------------------
増減機能のテストです
------------------------------*/
(0, 0) = 0.000000
(1, 0) = 0.125000
(2, 0) = 0.250000
(0, 1) = 0.375000
(1, 1) = 0.500000
(2, 1) = 0.625000
(0, 2) = 0.750000
(1, 2) = 0.875000
(2, 2) = 1.000000

[ aray2 ] str(3, 2, 1) L=115
(0, 0, 0) =
(1, 0, 0) =
(2, 0, 0) =
(0, 1, 0) =
(1, 1, 0) =
(2, 1, 0) =

[ aray2 ] str(3, 2, 1) L=117
/*------------------------------
増減機能は文字列に対してはインデックス付与として機能します。
------------------------------*/
(0, 0, 0) = *main
(1, 0, 0) = *main1
(2, 0, 0) = *main2
(0, 1, 0) = *main3
(1, 1, 0) = *main4
(2, 1, 0) = *main5

[ aray2 ] str(3, 2, 1) L=119
/*------------------------------
増減値に文字列を指定することも可能です()
(｀･ω･´)ゞ
------------------------------*/
(0, 0, 0) = ABCDEFG
(1, 0, 0) = ABCDEFG(｀･ω･´)ゞ
(2, 0, 0) = ABCDEFG(｀･ω･´)ゞ(｀･ω･´)ゞ
(0, 1, 0) = ABCDEFG(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ
(1, 1, 0) = ABCDEFG(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ
(2, 1, 0) = ABCDEFG(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ(｀･ω･´)ゞ

[ aray4 ] int(4, 3, 2, 1) L=133
/*------------------------------
負の値も指定可
------------------------------*/
(0, 0, 0, 0) = 100
(1, 0, 0, 0) = 90
(2, 0, 0, 0) = 80
(3, 0, 0, 0) = 70
(0, 1, 0, 0) = 60
(1, 1, 0, 0) = 50
(2, 1, 0, 0) = 40
(3, 1, 0, 0) = 30
(0, 2, 0, 0) = 20
(1, 2, 0, 0) = 10
(2, 2, 0, 0) = 0
(3, 2, 0, 0) = -10
(0, 0, 1, 0) = -20
(1, 0, 1, 0) = -30
(2, 0, 1, 0) = -40
(3, 0, 1, 0) = -50
(0, 1, 1, 0) = -60
(1, 1, 1, 0) = -70
(2, 1, 1, 0) = -80
(3, 1, 1, 0) = -90
(0, 2, 1, 0) = -100
(1, 2, 1, 0) = -110
(2, 2, 1, 0) = -120
(3, 2, 1, 0) = -130
~~~

</details>

<!----------------------------------------------------------------------------->

<br>

## 導入方法（Introduction）

~~~
.
├─ 02_myarray.hsp
│
├── 02_myarray
│   ├── 02_myarray.hs
│   ├── 02_1_PriSetOut.hsp
│   ├── 02_2_CnvOut.hsp
│   ├── 02_3_Cnv.hsp
│   ├── 02_4_Lab.hsp
│   └── 02_myarray.txt
│
├── README.md
├── README.html
└── License.txt
~~~

* 02_myarray.hsp をユーザースクリプトのディレクトリか、HSP のインストールディレクトリ下の commonフォルダ内において、02_myarray.hspをインクルードしてください。

        例） hsp37/common/02_myarray.hsp

* 02_myarrayフォルダをHSPのインストールディレクトリ下にある **doclibフォルダ内に02_myarrayフォルダごと** 置いて下さい。サンプルファイルもそのままで構いません。

        例） hsp37/doclib/02_myarray

<br>

## 必要環境（Environment）

* Windows10, 11
* HSP3.6以上

## 使用言語（Coding Language）

* [Hot Soup Processor(HSP3)](https://hsp.tv/)


## 開発環境（Development environment）

* Windows11 Pro 22H2 x64
* Hot Soup Processor 3.7beta4
* Visual Studio Code ver 1.74.1

## LICENSE

本ソフトウェアおよび関連文書のファイル（以下「ソフトウェア」）の複製を取得するすべての人に対し、ソフトウェアを無制限に扱うことを無償で許可します。

これには、ソフトウェアの複製を使用、複写、変更、結合、掲載、頒布、サブライセンス、および/または販売する権利、およびソフトウェアを提供する相手に同じことを許可する権利も無制限に含まれます。


ソフトウェアは「現状のまま」で、明示であるか暗黙であるかを問わず、何らの保証もなく提供されます。ここでいう保証とは、商品性、特定の目的への適合性、および権利非侵害についての保証も含みますが、それに限定されるものではありません。

作者または著作権者は、契約行為、不法行為、またはそれ以外であろうと、ソフトウェアに起因または関連し、あるいはソフトウェアの使用またはその他の扱いによって生じる一切の請求、損害、その他の義務について何らの責任も負わないものとします。

<br>

## 謝 辞（SPECIAL THANKS）

* HSPTV!掲示板の皆様

このモジュールは [HSPTV!掲示板][HSPTV!掲示板] の皆様によって支えられております。
この場を借りて感謝申し上げます。誠に有難うございます。


|  項 目  |           掲示板情報           |
|:-------:|:------------------------------:|
|  Kind   |             宣 伝              |
|  Date   |           2022/11/26           |
| Person  |           Yuzranium            |
| Pontent | 多次元配列変数を複数行文字列に |

<br>

## 今後の予定
* [x] ヘルプファイルの作製
* [x] ヘッダファイルのコメントの充実
* [x] サンプルファイルのコメントの充実
* [x] 配列変数への一括代入命令の追加
* [x] ラベル型の表面上の文字列にインデックスをつけるのが私の夢です()
* [ ] 次元要素の書き出し範囲の指定ができるようにしたい<br>（4次元配列をすべて書き出すとなるとユーザーのPCに膨大な負荷がかかる恐れがあるため）

<br>

## 更新履歴（Change Log）

### ver 0.26.1
2022/12/20
`priarray命令`にラベル型配列変数のラベル名表示機能を追加（2022/12/18現在、最適化できておらず）

* 新規追加命令
    * `outarray命令` の追加
        * 多次元配列変数の値のみを複数行文字列として書き出す
    * `cnvarray命令` の追加
        * 複数行文字列、多次元配列変数を別の多次元配列変数へ変換する
    * `labarray命令` の追加
        * 文字列型配列変数を複数行文字列として書き出し、ラベル型に変換する

* その他
    * スクリプトの修正
    * コメント表示の書式微修正
    * 内部関数 `ainfo_関数`の命令化

### ver 0.25
2022/12/07
書き出し命令 `priarray命令` にコメント機能の追加
一括代入命令 `setarray命令` に増減機能の追加
一部コードの改修

### ver 0.24
2022/12/05
多次元配列変数への一括代入`setarray命令`の追加
値の書き出しができないラベル型、モジュール型、COMオブジェクト型を指定した際に変数の使用状況（`varuse関数`）とエラーレポートを表示する機能を追加

### ver 0.23
2022/12/04
書き出し方法の大幅改良
一部スクリプトの効率化

### ver 0.22
2022/12/01
配列情報の表示方法の変更

### ver 0.21
2022/11/29
パラメーターの修正

### ver 0.20
2022/11/26
ヘッダファイル、サンプルファイルの修正

### ver 0.10
2022/11/25
初公開